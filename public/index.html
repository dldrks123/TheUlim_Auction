<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TheUlim Auction (LoL Draft)</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1 { color: #007bff; text-align: center; }
        .lobby, .auction { margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .player-list { list-style: none; padding: 0; }
        .player-list li { margin-bottom: 5px; padding: 8px; background: #eee; border-radius: 3px; }
        .ready-btn { background-color: #28a745; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px; margin-top: 10px; }
        .auction-info { border: 2px solid #007bff; padding: 15px; margin-bottom: 15px; background: #e9f7ff; }
        #timer { font-size: 2em; font-weight: bold; color: #dc3545; }
        #log { margin-top: 20px; padding: 10px; background: #f9f9f9; max-height: 200px; overflow-y: scroll; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <div class="container">
        <h1>TheUlim Auction ğŸš€</h1>
        <p>ì ‘ì†ì: <span id="my-id"></span></p>

        <div class="lobby" id="lobby-section">
            <h2>ë¡œë¹„</h2>
            <p>
                ë‹‰ë„¤ì„: <input type="text" id="nickname-input" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”">
                <button onclick="setNickname()">ë³€ê²½</button>
            </p>
            <h3>ì ‘ì† í˜„í™© (ìµœëŒ€ 3ëª…)</h3>
            <ul id="player-list" class="player-list">
                </ul>
            <button class="ready-btn" id="ready-btn" onclick="sendReady()">ì¤€ë¹„ ì™„ë£Œ</button>
            <p id="lobby-status"></p>
        </div>

        <div class="auction" id="auction-section" style="display: none;">
            <h2>í˜„ì¬ ê²½ë§¤</h2>
            <div class="auction-info">
                <p>ë‚¨ì€ ì‹œê°„: <span id="timer">--</span>ì´ˆ</p>
                <p>ì„ ìˆ˜: <span id="item-name">--</span> (<span id="item-position">--</span>)</p>
                <p>í˜„ì¬ê°€: <span id="current-price">0</span> í¬ì¸íŠ¸</p>
                <p>ìµœê³  ì…ì°°ì: <span id="top-bidder">ì—†ìŒ</span></p>
            </div>
            
            <input type="number" id="bid-input" placeholder="ìµœì†Œ ì…ì°°ê°€ +10">
            <button onclick="sendBid()">ì…ì°°í•˜ê¸°</button>

            <h3>ê²½ë§¤ ë¡œê·¸</h3>
            <div id="log"></div>
        </div>
    </div>

    <script>
        const socket = io();
        let myId = '';
        let myNickname = 'P?';
        let currentItemId = null;

        // --- UI ìš”ì†Œ ë§µí•‘ ---
        const lobbySection = document.getElementById('lobby-section');
        const auctionSection = document.getElementById('auction-section');
        const nicknameInput = document.getElementById('nickname-input');
        const playerList = document.getElementById('player-list');
        const log = document.getElementById('log');

        const timerDisplay = document.getElementById('timer');
        const itemNameDisplay = document.getElementById('item-name');
        const itemPositionDisplay = document.getElementById('item-position');
        const currentPriceDisplay = document.getElementById('current-price');
        const topBidderDisplay = document.getElementById('top-bidder');
        const bidInput = document.getElementById('bid-input');
        const readyBtn = document.getElementById('ready-btn');
        const lobbyStatus = document.getElementById('lobby-status');


        // --- SOCKET ìˆ˜ì‹  ì²˜ë¦¬ ---

        socket.on('player_info', (data) => {
            myId = data.id;
            myNickname = data.nickname;
            document.getElementById('my-id').textContent = myNickname;
            nicknameInput.value = myNickname;
        });

        socket.on('lobby_update', (data) => {
            playerList.innerHTML = '';
            data.players.forEach(p => {
                const li = document.createElement('li');
                li.textContent = `${p.nickname} [${p.ready ? 'âœ… ì¤€ë¹„ë¨' : 'âŒ ë¯¸ì¤€ë¹„'}]`;
                playerList.appendChild(li);
            });
        });

        socket.on('game_start', (message) => {
            logMessage(`[ì‹œìŠ¤í…œ] ${message}`, 'green');
            lobbySection.style.display = 'none';
            auctionSection.style.display = 'block';
        });

        socket.on('auction_start', (item) => {
            currentItemId = item.id;
            itemNameDisplay.textContent = item.name;
            itemPositionDisplay.textContent = item.position;
            currentPriceDisplay.textContent = item.price;
            topBidderDisplay.textContent = 'ì—†ìŒ';
            bidInput.value = item.price + 10;
            logMessage(`[ê²½ë§¤ ì‹œì‘] ${item.name} (${item.position})`, 'blue');
        });

        socket.on('update_timer', (data) => {
            timerDisplay.textContent = data.time;
        });

        socket.on('update_bid', (data) => {
            currentPriceDisplay.textContent = data.price;
            topBidderDisplay.textContent = data.bidder;
            bidInput.value = data.price + 10;
            logMessage(`[ì…ì°°] ${data.bidder}: ${data.price} í¬ì¸íŠ¸`, 'orange');
        });

        socket.on('auction_result', (data) => {
            if (data.status === 'ACQUIRED') {
                logMessage(`ğŸ† [ë‚™ì°°] ${data.item.name}ì´(ê°€) ${data.item.finalPrice}ì— ${data.winner}ì—ê²Œ ë‚™ì°°ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'red');
            } else if (data.status === 'FAILED') {
                logMessage(`ğŸš« [ìœ ì°°] ${data.item.name}ì€ ìœ ì°°ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'gray');
            }
            timerDisplay.textContent = '--';
        });

        socket.on('auto_acquisition', (data) => {
            logMessage(`â­ [ìë™ ë‚™ì°°] ${data.item.name} (${data.item.position}) ì„ ìˆ˜ê°€ ${data.winner}ì—ê²Œ 0ì›ì— ìë™ ë‚™ì°°ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'purple');
        });

        socket.on('error_message', (message) => {
            logMessage(`[ì˜¤ë¥˜] ${message}`, 'red');
        });

        // --- SOCKET ì†¡ì‹  ì²˜ë¦¬ (í´ë¦­ ì´ë²¤íŠ¸ì™€ ì—°ê²°ë¨) ---

        function setNickname() {
            const nickname = nicknameInput.value.trim();
            if (nickname) {
                socket.emit('set_nickname', nickname);
                myNickname = nickname;
            }
        }

        function sendReady() {
            socket.emit('ready');
            readyBtn.disabled = true;
            lobbyStatus.textContent = 'ì¤€ë¹„ ì™„ë£Œ ëŒ€ê¸° ì¤‘...';
        }

        function sendBid() {
            const price = parseInt(bidInput.value);
            if (price && currentItemId) {
                socket.emit('bid', price);
            } else {
                alert('ìœ íš¨í•œ ì…ì°° ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.');
            }
        }

        // --- ê¸°íƒ€ UI í•¨ìˆ˜ ---
        function logMessage(message, color) {
            const p = document.createElement('p');
            p.textContent = message;
            p.style.color = color;
            log.prepend(p);
        }
        
    </script>
</body>
</html>