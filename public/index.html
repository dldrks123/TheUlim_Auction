<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TheUlim Auction (LoL Draft)</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        /* ì œê³µí•´ì£¼ì‹  ë””ìì¸ CSS ìœ ì§€ */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        .main-container { max-width: 1200px; margin: auto; display: flex; gap: 20px; }
        .left-panel { flex: 2; }
        .right-panel { flex: 1; }
        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h1 { color: #007bff; text-align: center; margin-bottom: 20px;}
        h2 { border-bottom: 2px solid #007bff; padding-bottom: 5px; margin-bottom: 15px; }
        .lobby, .auction { margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .player-list { list-style: none; padding: 0; }
        .player-list li { margin-bottom: 5px; padding: 8px; background: #eee; border-radius: 3px; }
        .ready-btn { background-color: #28a745; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px; margin-top: 10px; }
        .auction-info { border: 2px solid #007bff; padding: 15px; margin-bottom: 15px; background: #e9f7ff; }
        #timer { font-size: 2em; font-weight: bold; color: #dc3545; }
        #log { margin-top: 20px; padding: 10px; background: #f9f9f9; max-height: 200px; overflow-y: scroll; border: 1px solid #ccc; }
        
        /* ì…ì°° ë²„íŠ¼ ê·¸ë£¹ */
        .bid-controls { display: flex; flex-wrap: wrap; align-items: center; gap: 10px; margin-top: 10px;}
        .bid-controls input[type="number"] { padding: 8px; width: 100px; text-align: right; }
        .bid-controls button { padding: 10px 15px; font-weight: bold; cursor: pointer; border: none; border-radius: 5px; }
        .bid-controls .bid-btn-inc { background-color: #ffc107; color: #333; }
        .bid-controls .bid-btn-main { background-color: #007bff; color: white; flex-grow: 1; }
        .bid-controls button:disabled { background-color: #ccc; cursor: not-allowed; }

        /* í”Œë ˆì´ì–´ ìƒíƒœ UI */
        .player-card { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
        .current-bidder { border: 3px solid #ffc107; background-color: #fff8e1 !important; } /* â­ ìµœê³  ì…ì°°ì ê°•ì¡° */
        .roster-list { font-size: 0.9em; margin-top: 5px; }
        .auction-item-list { list-style: none; padding: 0; font-size: 0.9em;}
        .auction-item-list li { padding: 5px; border-bottom: 1px dotted #eee; }
        .item-status-ACQUIRED { color: green; font-weight: bold; }
        .item-status-FAILED { color: orange; }
        .item-status-UNSOLD { color: #333; }
        .item-status-current { background-color: #f0f8ff; border-left: 5px solid #007bff; padding-left: 10px;} /* í˜„ì¬ ê²½ë§¤ ì¤‘ì¸ ì•„ì´í…œ */
        .player-cannot-bid { opacity: 0.6; } /* í¬ì§€ì…˜ ì œí•œ ë“±ìœ¼ë¡œ ì…ì°° ë¶ˆê°€ */

        /* â­ 6. ë‹¤ìŒ ê²½ë§¤ ëŒ€ê¸° UI */
        #wait-info { 
            text-align: center; 
            padding: 20px; 
            background: #e6ffe6; /* ì—°í•œ ì´ˆë¡ìƒ‰ */
            border: 2px dashed #28a745;
            border-radius: 8px; 
            margin-bottom: 15px;
        }
        #wait-timer { font-size: 3em; font-weight: bold; color: #28a745; }

    </style>
</head>
<body>
    <div class="main-container">
        <div class="left-panel">
            <div class="container">
                <h1>TheUlim Auction ğŸš€</h1>
                <p>ì ‘ì†ì: <span id="my-id"></span></p>
                <p>ë‚´ ë‚¨ì€ í¬ì¸íŠ¸: <strong id="my-points">1000</strong>p</p>

                <div class="lobby" id="lobby-section">
                    <h2>ë¡œë¹„</h2>
                    <p>
                        ë‹‰ë„¤ì„: <input type="text" id="nickname-input" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”">
                        <br>
                        ì‹œì‘ í¬ì¸íŠ¸: <input type="number" id="start-points-input" value="1000" min="10" step="10" style="width: 100px; text-align: right;">p
                        <button onclick="setNicknameAndPoints()">ë³€ê²½</button>
                    </p>
                    <h3>ì ‘ì† í˜„í™© (3/3ëª… í•„ìš”)</h3>
                    <ul id="player-list" class="player-list"></ul>
                    <button class="ready-btn" id="ready-btn" onclick="sendReady()" disabled>ì¤€ë¹„ ì™„ë£Œ</button>
                    <p id="lobby-status"></p>
                </div>

                <div class="auction" id="auction-section" style="display: none;">

                    <div id="wait-info" style="display: none;">
                        <h3>ê²½ë§¤ ëŒ€ê¸° ì¤‘...</h3>
                        <p>ë‹¤ìŒ ì„ ìˆ˜: <strong id="next-item-name">--</strong> (<strong id="next-item-position">--</strong>)</p>
                        <p>ë‚¨ì€ ì‹œê°„: <span id="wait-timer">--</span>ì´ˆ</p>
                    </div>
                    
                    <h2 id="auction-title">í˜„ì¬ ê²½ë§¤</h2>

                    <div class="auction-info">
                        <p>ë‚¨ì€ ì‹œê°„: <span id="timer">--</span>ì´ˆ</p>
                        <p>ì„ ìˆ˜: <strong id="item-name">--</strong> (<strong id="item-position">--</strong>)</p>
                        <p>í˜„ì¬ê°€: <strong id="current-price">0</strong> í¬ì¸íŠ¸</p>
                        <p>ìµœê³  ì…ì°°ì: <strong id="top-bidder">ì—†ìŒ</strong></p>
                    </div>
                    
                    <div class="bid-controls">
                        <button class="bid-btn-inc" onclick="decreaseBid(10)">-10</button>
                        <button class="bid-btn-inc" onclick="decreaseBid(50)">-50</button>
                        <button class="bid-btn-inc" onclick="decreaseBid(100)">-100</button>

                        <input type="number" id="bid-input" placeholder="ì§ì ‘ ì…ë ¥" value="10" oninput="updateBidButtonState()">
                        
                        <button class="bid-btn-inc" onclick="increaseBid(10)">+10</button>
                        <button class="bid-btn-inc" onclick="increaseBid(50)">+50</button>
                        <button class="bid-btn-inc" onclick="increaseBid(100)">+100</button>
                        
                        <button class="bid-btn-main" id="bid-button" onclick="sendBid()" disabled>ì…ì°°í•˜ê¸°</button>
                    </div>
                    <p id="bid-restriction-message" style="color: red; margin-top: 10px; font-weight: bold;"></p>


                    <h3>ê²½ë§¤ ë¡œê·¸</h3>
                    <div id="log"></div>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="container">
                <h2>í”Œë ˆì´ì–´ ìƒíƒœ</h2>
                <div id="player-status-panel">
                </div>
            </div>
            
            <div class="container">
                <h2>ê²½ë§¤ ìˆœì„œ ë° í˜„í™© (ì´ 12ëª…)</h2>
                <ul id="auction-status-list" class="auction-item-list">
                </ul>
            </div>
        </div>
    </div>


<script>
    const socket = io();
    let myId = '';
    let myNickname = 'P?';
    let currentItemId = null;
    let myPoints = 1000;
    let currentBidPrice = 0; // í˜„ì¬ ê²½ë§¤ê°€ (UI ë™ê¸°í™”ìš©)
    let currentTopBidderId = null; // ìµœê³  ì…ì°°ì ID
    let currentItemPosition = null; // í˜„ì¬ ê²½ë§¤ ì„ ìˆ˜ì˜ í¬ì§€ì…˜ (ì†Œë¬¸ì)
    // í¬ì§€ì…˜ë³„ ìµœëŒ€ 1ëª…ìœ¼ë¡œ ì œí•œ (ì„œë²„ì™€ ë™ì¼í•˜ê²Œ 1ë¡œ ê°€ì •)
    const MAX_POS_PER_PLAYER = 1;
    let myRoster = { top: 0, mid: 0, sup: 0, jungle: 0, ad: 0, top: 0 }; // ë‚´ ë¡œìŠ¤í„° ìƒíƒœ ì €ì¥ (í¬ì§€ì…˜ë³„ ì¹´ìš´íŠ¸)

    // --- UI ìš”ì†Œ ë§µí•‘ ---
    const lobbySection = document.getElementById('lobby-section');
    const auctionSection = document.getElementById('auction-section');
    const nicknameInput = document.getElementById('nickname-input');
    const startPointsInput = document.getElementById('start-points-input');
    const playerList = document.getElementById('player-list');
    const log = document.getElementById('log');
    const myPointsDisplay = document.getElementById('my-points');
    const playerStatusPanel = document.getElementById('player-status-panel');
    const auctionStatusList = document.getElementById('auction-status-list');

    const timerDisplay = document.getElementById('timer');
    const itemNameDisplay = document.getElementById('item-name');
    const itemPositionDisplay = document.getElementById('item-position');
    const currentPriceDisplay = document.getElementById('current-price');
    const topBidderDisplay = document.getElementById('top-bidder');
    const bidInput = document.getElementById('bid-input');
    const readyBtn = document.getElementById('ready-btn');
    const lobbyStatus = document.getElementById('lobby-status');
    const bidButton = document.getElementById('bid-button');
    const bidRestrictionMessage = document.getElementById('bid-restriction-message');

    // ë‹¤ìŒ ê²½ë§¤ ëŒ€ê¸° UI
    const waitInfo = document.getElementById('wait-info');
    const auctionTitle = document.getElementById('auction-title');
    const waitTimer = document.getElementById('wait-timer');
    const nextItemName = document.getElementById('next-item-name');
    const nextItemPosition = document.getElementById('next-item-position');


    // --- SOCKET ìˆ˜ì‹  ì²˜ë¦¬ ---

    socket.on('player_info', (data) => {
        myId = data.id;
        myNickname = data.nickname;
        myPoints = data.points;
        
        document.getElementById('my-id').textContent = myNickname;
        nicknameInput.value = myNickname;
        startPointsInput.value = myPoints;
        myPointsDisplay.textContent = myPoints;
        
        // ë‹‰ë„¤ì„ ì„¤ì • ì„±ê³µ í›„ ì¤€ë¹„ ë²„íŠ¼ í™œì„±í™”
        readyBtn.disabled = false;
    });

    socket.on('lobby_update', (data) => {
        playerList.innerHTML = '';
        data.players.forEach(p => {
            const li = document.createElement('li');
            li.textContent = `${p.nickname} [${p.ready ? 'âœ… ì¤€ë¹„ë¨' : 'âŒ ë¯¸ì¤€ë¹„'}]`;
            playerList.appendChild(li);
        });
    });

    socket.on('game_start', (message) => {
        logMessage(`[ì‹œìŠ¤í…œ] ${message}`, 'green');
        lobbySection.style.display = 'none';
        auctionSection.style.display = 'block';
    });

    socket.on('game_update', (data) => {
        logMessage(`[ì‹œìŠ¤í…œ] ${data.message}`, 'blue');
        
        if (data.message.includes('ë¡œë¹„ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤')) {
            lobbySection.style.display = 'block';
            auctionSection.style.display = 'none';
            readyBtn.disabled = false;
            lobbyStatus.textContent = '';
            
            // ì´ˆê¸°í™”
            currentItemId = null;
            currentItemPosition = null;
            currentBidPrice = 0;
            waitInfo.style.display = 'none';
            auctionTitle.style.display = 'block';
            auctionTitle.textContent = 'í˜„ì¬ ê²½ë§¤'; // ì œëª© ì´ˆê¸°í™”
        }
    });

    // ë‹¤ìŒ ê²½ë§¤ ëŒ€ê¸° íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
    socket.on('pre_auction_wait', (data) => {
        waitInfo.style.display = 'block';
        auctionTitle.style.display = 'none';
        timerDisplay.textContent = '--';
        currentItemId = null; // ê²½ë§¤ ëŒ€ê¸° ì¤‘ì—ëŠ” ì•„ì´í…œ ID ë¹„ìš°ê¸°
        currentItemPosition = null; // í¬ì§€ì…˜ ë¹„ìš°ê¸°
        currentBidPrice = 0; // ê²½ë§¤ ëŒ€ê¸° ì¤‘ì—ëŠ” í˜„ì¬ê°€ 0ìœ¼ë¡œ ì´ˆê¸°í™”
        currentTopBidderId = null; // ìµœê³  ì…ì°°ì ID ì´ˆê¸°í™”

        waitTimer.textContent = data.time;
        nextItemName.textContent = data.nextItem ? data.nextItem.name : 'ê²½ë§¤ ì¢…ë£Œ';
        nextItemPosition.textContent = data.nextItem ? data.nextItem.position.toUpperCase() : '--';
        
        // â­ ìœ ì°° ê²½ë§¤ ì—¬ë¶€ì— ë”°ë¼ ëŒ€ê¸° ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
        const phaseMessage = data.isFailedAuction ? '2ì°¨ ìœ ì°° ê²½ë§¤ ëŒ€ê¸° ì¤‘...' : 'ë‹¤ìŒ ê²½ë§¤ ëŒ€ê¸° ì¤‘...';
        waitInfo.querySelector('h3').textContent = phaseMessage;
        
        // ê²½ë§¤ ì •ë³´ ì´ˆê¸°í™”
        itemNameDisplay.textContent = '--';
        itemPositionDisplay.textContent = '--';
        currentPriceDisplay.textContent = '0';
        topBidderDisplay.textContent = 'ì—†ìŒ';
        bidInput.value = 10;
        
        updateBidButtonState(); // ì…ì°° ë²„íŠ¼ ë¹„í™œì„±í™”
        
        // ê²½ë§¤ ìˆœì„œ ëª©ë¡ì—ì„œ í˜„ì¬ ë¬¼í’ˆ í•˜ì´ë¼ì´íŠ¸ í•´ì œ
        document.querySelectorAll('.auction-item-list li').forEach(li => li.classList.remove('item-status-current'));
    });

    // ê²½ë§¤ ì‹œì‘
    socket.on('auction_start', (data) => { // ì„œë²„ì—ì„œ { item: ..., phase: ... } í˜•íƒœë¡œ ì „ì†¡
        waitInfo.style.display = 'none';
        auctionTitle.style.display = 'block';
        
        currentItemId = data.item.id;
        currentItemPosition = data.item.position; // í¬ì§€ì…˜ ì €ì¥ (ì†Œë¬¸ì)
        currentBidPrice = 0;
        currentTopBidderId = null; 

        // â­ ê²½ë§¤ ë‹¨ê³„ì— ë”°ë¼ ì œëª© ì—…ë°ì´íŠ¸
        auctionTitle.textContent = (data.phase === 'Bidding_Failed' ? '2ì°¨ ìœ ì°° ê²½ë§¤' : 'í˜„ì¬ ê²½ë§¤');

        itemNameDisplay.textContent = data.item.name;
        itemPositionDisplay.textContent = data.item.position.toUpperCase();
        currentPriceDisplay.textContent = currentBidPrice;
        topBidderDisplay.textContent = 'ì—†ìŒ';

        // ì…ì°° ì°½ ì´ˆê¸°í™”
        bidInput.value = 10; 
        updateBidButtonState(); // ìƒˆë¡œìš´ ê²½ë§¤ ì‹œì‘ ì‹œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸

        logMessage(`[ê²½ë§¤ ì‹œì‘] ${data.item.name} (${data.item.position.toUpperCase()}) ê²½ë§¤ ì‹œì‘!`, '#007bff');
    });

    // ... (ë‚˜ë¨¸ì§€ ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œëŠ” ë™ì¼í•˜ê²Œ ìœ ì§€)
    socket.on('full_server', (message) => {
        alert(message);
    });

    socket.on('error_message', (message) => {
        logMessage(`[ì˜¤ë¥˜] ${message}`, 'red');
    });

    socket.on('update_timer', (data) => {
        if (currentItemId === data.itemId) {
            timerDisplay.textContent = data.time;
        }
    });

    socket.on('update_bid', (data) => {
        if (currentItemId === data.itemId) {
            currentBidPrice = data.price;
            currentTopBidderId = data.bidderId; // ì„œë²„ì—ì„œ bidderIdë¥¼ ë³´ë‚´ëŠ” ë¶€ë¶„ì´ ì—†ìœ¼ë¯€ë¡œ bidder ë‹‰ë„¤ì„ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•¨
            
            // ì„œë²„ì—ì„œ topBidderIdë§Œ ë³´ë‚´ì§€ ì•Šê³  ë‹‰ë„¤ì„ì„ ë³´ë‚´ë¯€ë¡œ, ì—¬ê¸°ì„œëŠ” ë‹‰ë„¤ì„ë§Œ í‘œì‹œí•©ë‹ˆë‹¤.
            currentPriceDisplay.textContent = data.price;
            topBidderDisplay.textContent = data.bidder;
            logMessage(`[ì…ì°°] ${data.bidder}: ${data.price}p`, '#ffc107');
            updateBidButtonState();
        }
    });
    
    socket.on('auction_result', (data) => {
        let message;
        let color;
        if (data.status === 'ACQUIRED') {
            message = `[ë‚™ì°°] ${data.item.name} ì„ ìˆ˜, ${data.winner}ì—ê²Œ ${data.item.finalPrice}pì— ë‚™ì°°!`;
            color = 'green';
        } else {
            message = `[ìœ ì°°] ${data.item.name} ì„ ìˆ˜ ê²½ë§¤ ì‹¤íŒ¨!`;
            color = 'orange';
        }
        logMessage(message, color);
        // ê²½ë§¤ ê²°ê³¼ê°€ ë‚˜ì˜¨ í›„ ì…ì°° ë²„íŠ¼ ë¹„í™œì„±í™” (Wait_Next_Item í˜ì´ì¦ˆë¡œ ì „í™˜)
        updateBidButtonState(); 
    });

    socket.on('auto_acquisition', (data) => {
        logMessage(`[ìë™ ë‚™ì°°] ${data.item.name} (${data.item.position.toUpperCase()}) ì„ ìˆ˜, ${data.winner}ì—ê²Œ 0ì›ì— ìë™ ë‚™ì°°ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'purple');
    });
    

    socket.on('player_status_update', (playerStatuses) => {
        playerStatusPanel.innerHTML = '';
        let myAcquiredRoster = {}; // ë‚´ ë¡œìŠ¤í„° ìƒíƒœë¥¼ ì¶”ì í•  ì„ì‹œ ê°ì²´

        playerStatuses.forEach(p => {
            const isMe = p.id === myId;
            let canBid = p.canBid; // ì„œë²„ì—ì„œ ë°›ì€ ì…ì°° ê°€ëŠ¥ ì—¬ë¶€
            let bidRestriction = '';
            
            if (isMe) {
                myPoints = p.points;
                myPointsDisplay.textContent = myPoints;
            }

            // í¬ì§€ì…˜ë³„ ë¡œìŠ¤í„° ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸ ë° ë©”ì‹œì§€ ì¤€ë¹„
            let rosterHtml = '';
            myAcquiredRoster = { top: 0, mid: 0, sup: 0, jungle: 0, ad: 0 };
            p.roster.forEach(item => {
                myAcquiredRoster[item.position]++;
                rosterHtml += `<span style="font-size:0.8em; margin-right:5px; padding: 2px 5px; background:#ddd; border-radius:3px;">${item.position.toUpperCase()}: ${item.name} (${item.price}p)</span>`;
            });

            // í¬ì§€ì…˜ ì œí•œ ë©”ì‹œì§€ (ë‚˜ì—ê²Œë§Œ í•´ë‹¹)
            if (isMe && currentItemPosition && myAcquiredRoster[currentItemPosition] >= MAX_POS_PER_PLAYER) {
                 bidRestriction = `<span style="color:red; font-weight:bold;">(${currentItemPosition.toUpperCase()} í¬ì§€ì…˜ ì œí•œ ì´ˆê³¼)</span>`;
                 canBid = false; // ì„œë²„ì—ì„œ ì´ë¯¸ ê³„ì‚°í–ˆì§€ë§Œ, ë¡œì»¬ì—ì„œë„ í™•ì¸
            }
            if (isMe) {
                myRoster = myAcquiredRoster; // ë‚´ ë¡œìŠ¤í„° ìƒíƒœ ê°±ì‹ 
            }

            const card = document.createElement('div');
            card.className = `player-card ${p.isTopBidder ? 'current-bidder' : ''} ${!canBid ? 'player-cannot-bid' : ''}`;
            card.innerHTML = `
                <strong>${p.nickname}${isMe ? ' (ë‚˜)' : ''}</strong>
                <p>ì”ì—¬ í¬ì¸íŠ¸: ${p.points}p</p>
                <div class="roster-list">
                    <strong>ë¡œìŠ¤í„°:</strong> ${rosterHtml || 'ì—†ìŒ'}
                </div>
                ${isMe ? bidRestriction : ''}
            `;
            playerStatusPanel.appendChild(card);
        });

        updateBidButtonState(); // ë¡œìŠ¤í„° ìƒíƒœ ë° ìµœê³  ì…ì°°ì ìƒíƒœ ë³€ê²½ ì‹œ ë²„íŠ¼ ìƒíƒœ ê°±ì‹ 
    });

    socket.on('auction_status_update', (auctionStatus) => {
        auctionStatusList.innerHTML = '';
        auctionStatus.forEach(item => {
            const li = document.createElement('li');
            const isCurrent = item.id === currentItemId;
            
            li.className = `item-status-${item.status}${isCurrent ? ' item-status-current' : ''}`;
            li.textContent = `${item.sequence}. ${item.name} (${item.position.toUpperCase()}) - ${
                item.status === 'ACQUIRED' ? 'ë‚™ì°°' : 
                item.status === 'FAILED' ? 'ìœ ì°°' : 'ëŒ€ê¸°'
            }`;
            auctionStatusList.appendChild(li);
        });
    });


    // --- UI/í´ë¼ì´ì–¸íŠ¸ ì¸¡ ë¡œì§ ---

    function logMessage(message, color) {
        const p = document.createElement('p');
        p.style.color = color;
        p.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        log.prepend(p);
        // ë¡œê·¸ê°€ ë„ˆë¬´ ê¸¸ì–´ì§€ì§€ ì•Šë„ë¡ ìµœì‹  50ê°œë§Œ ìœ ì§€
        while (log.children.length > 50) {
            log.removeChild(log.lastChild);
        }
    }

    function setNicknameAndPoints() {
        const nickname = nicknameInput.value.trim();
        const points = parseInt(startPointsInput.value);
        if (nickname.length > 0 && points > 0 && points % 10 === 0) {
            socket.emit('set_nickname_and_points', { nickname, points });
            lobbyStatus.textContent = 'ë‹‰ë„¤ì„/í¬ì¸íŠ¸ ì„¤ì • ì™„ë£Œ. ì¤€ë¹„ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.';
            lobbyStatus.style.color = 'green';
        } else {
             lobbyStatus.textContent = 'ë‹‰ë„¤ì„ê³¼ í¬ì¸íŠ¸(10p ë‹¨ìœ„, 0ë³´ë‹¤ í¬ê²Œ)ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •í•´ì£¼ì„¸ìš”.';
             lobbyStatus.style.color = 'red';
        }
    }

    function sendReady() {
        if (myNickname && myPoints > 0) {
            socket.emit('ready');
            readyBtn.disabled = true;
            lobbyStatus.textContent = 'ë‹¤ë¥¸ í”Œë ˆì´ì–´ì˜ ì¤€ë¹„ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...';
        }
    }

    function sendBid() {
        const bidPrice = parseInt(bidInput.value);
        if (currentItemId && bidPrice >= 10 && bidPrice % 10 === 0) {
            socket.emit('bid', bidPrice);
        } else {
            logMessage('ìœ íš¨í•˜ì§€ ì•Šì€ ì…ì°° ê¸ˆì•¡ì…ë‹ˆë‹¤. 10 í¬ì¸íŠ¸ ì´ìƒ, 10 í¬ì¸íŠ¸ ë‹¨ìœ„ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'red');
        }
    }
    
    // ì…ì°° ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ ë° ë©”ì‹œì§€ í‘œì‹œ
    function updateBidButtonState() {
        const bidPrice = parseInt(bidInput.value) || 0;
        const currentPrice = currentBidPrice;
        const bidIncrement = 10;
        const minStartBid = 10;
        
        let requiredPrice;
        if (currentPrice === 0) {
            requiredPrice = minStartBid;
        } else {
            requiredPrice = currentPrice + bidIncrement;
        }

        let canBidNow = true;
        let restrictionMessage = '';

        // 1. ê²½ë§¤ ì¤‘ì´ ì•„ë‹ ë•Œ
        if (!currentItemId) {
            canBidNow = false;
            restrictionMessage = 'ê²½ë§¤ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.';
        }
        // 2. ìµœê³  ì…ì°°ìì¼ ë•Œ
        else if (currentTopBidderId && currentTopBidderId === myNickname) {
            canBidNow = false;
            restrictionMessage = 'ë‹¹ì‹ ì´ ìµœê³  ì…ì°°ìì…ë‹ˆë‹¤. ë‹¤ìŒ í”Œë ˆì´ì–´ì˜ ì…ì°°ì„ ê¸°ë‹¤ë¦¬ì„¸ìš”.';
        }
        // 3. ìµœì†Œ ì…ì°°ê°€ ë¯¸ë§Œì¼ ë•Œ
        else if (bidPrice < requiredPrice) {
            canBidNow = false;
            restrictionMessage = `ìµœì†Œ ì…ì°° ê¸ˆì•¡: ${requiredPrice} í¬ì¸íŠ¸`;
        }
        // 4. í¬ì¸íŠ¸ ë¶€ì¡±
        else if (bidPrice > myPoints) {
            canBidNow = false;
            restrictionMessage = `ì”ì—¬ í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. (ë‚´ ì”ì—¬: ${myPoints}p)`;
        }
        // 5. í¬ì§€ì…˜ ì œí•œ
        else if (currentItemPosition && myRoster[currentItemPosition] >= MAX_POS_PER_PLAYER) {
            canBidNow = false;
            restrictionMessage = `ì´ë¯¸ ${currentItemPosition.toUpperCase()} í¬ì§€ì…˜ ì„ ìˆ˜ë¥¼ ${MAX_POS_PER_PLAYER}ëª… ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.`;
        }
        
        // 6. 10ë‹¨ìœ„ ì²´í¬
        else if (bidPrice % bidIncrement !== 0) {
            canBidNow = false;
            restrictionMessage = `ì…ì°°ì€ ${bidIncrement}p ë‹¨ìœ„ë¡œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.`;
        }
        
        bidButton.disabled = !canBidNow;
        bidButton.textContent = canBidNow ? `ì…ì°°í•˜ê¸° (${bidPrice}p)` : 'ì…ì°° ë¶ˆê°€';
        
        // ì…ì°°ê°€ ì…ë ¥ í•„ë“œ ì—…ë°ì´íŠ¸: ìµœì†Œ ì…ì°°ê°€ë³´ë‹¤ ì‘ì€ ê²½ìš°, ìµœì†Œ ì…ì°°ê°€ë¡œ ìë™ ì„¤ì •
        if (bidPrice < requiredPrice) {
            // bidInput.value = requiredPrice; // ì‚¬ìš©ì ê²½í—˜ì„ ìœ„í•´ ìë™ ë³€ê²½ ëŒ€ì‹  ë©”ì‹œì§€ë§Œ í‘œì‹œ
        }


        // í˜„ì¬ê°€ê°€ 0ì´ë©´ ìµœì†Œ ì…ì°°ê°€ë¡œ ì„¤ì •
        if (currentPrice === 0 && bidInput.value < minStartBid) {
            bidInput.value = minStartBid;
        }


        bidRestrictionMessage.textContent = restrictionMessage;
    }


    function increaseBid(amount) {
        const currentVal = parseInt(bidInput.value) || 0;
        bidInput.value = currentVal + amount;
        updateBidButtonState();
    }

    function decreaseBid(amount) {
        const currentVal = parseInt(bidInput.value) || 0;
        let newVal = currentVal - amount;
        // ìµœì†Œ ì…ì°° ê¸ˆì•¡ ì•„ë˜ë¡œ ë‚´ë ¤ê°€ì§€ ì•Šë„ë¡ í•¨
        const minVal = currentBidPrice === 0 ? 10 : currentBidPrice + 10;
        if (newVal < minVal) {
             newVal = minVal;
        }
        bidInput.value = newVal > 0 ? newVal : 10;
        updateBidButtonState();
    }
    
    // ì´ˆê¸° ìƒíƒœì—ì„œ ë²„íŠ¼ ë¹„í™œì„±í™”
    document.addEventListener('DOMContentLoaded', () => {
        updateBidButtonState();
        nicknameInput.value = 'P' + Math.floor(Math.random() * 999);
        startPointsInput.value = 1000;
        
        // ì—”í„°í‚¤ë¡œ ì…ì°° ì‹¤í–‰
        bidInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                sendBid();
            }
        });
    });

</script>
</body>
</html>